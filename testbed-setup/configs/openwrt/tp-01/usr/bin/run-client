#!/bin/sh

if [ $# -lt 3 ]
then
	echo "usage : $0 <server-ip> <server-port> <protocol> <bitrate>"
	exit 1
fi

ip=$1
port=$2
proto=$3
bitrate=$4

# add specific routes to divide traffic between 802.11ac and 802.11ad interfaces
ip route add 192.168.0.147/32 via 192.168.0.1 dev wlan0
ip route add 192.168.0.148/32 via 192.168.0.1 dev wlan2

# restart iperf3
if [ "$proto" == "udp" ]
then
	iperf3 -V -t 3600 -c "$ip" -p "$port" -u -b "$bitrate"M -R -i 2 &> /dev/null &
else
	iperf3 -V -t 3600 -c "$ip" -p "$port" -R -i 2 &> /dev/null &
fi

exit 0
