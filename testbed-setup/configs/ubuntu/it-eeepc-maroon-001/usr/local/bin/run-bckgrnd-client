#!/bin/bash

if [ $# -lt 3 ]
then
    echo "usage : $0 <server-ip> <server-port> <protocol> <bitrate>"
    exit 1
fi

ip=$1
port=$2
proto=$3
bitrate=$4

# restart iperf3 server
ssh -i $HOME/.ssh/it "adamiaonr@10.10.10.141" "ps -ef | grep iperf3 | grep -v grep | grep $port | awk '{print \$2}' | sudo xargs kill -9"
ssh -i $HOME/.ssh/it "adamiaonr@10.10.10.141" "iperf3 -s -B $ip -p $port &> /dev/null < /dev/null &"
# start client
ssh -i $HOME/.ssh/it "root@10.10.10.115" "run-client $ip $port $proto $bitrate"

exit 0
